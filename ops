{"version":1,"ops":[{"type":6,"author":{"id":"8bb2e2064051e551a5dd57a858a993fc9e61081d"},"timestamp":1613991656,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlRWRpdDo0OTcxODk3MDQ="},"target":"2816502c5a2004e5b417bd9a9f926f1577bb683ea50cfc6c1812476e83ffba1b","message":"I'll use timeout as the example, but it applies to quite a few others as \nwell; that's just the one I encountered it on.\n\nI'm on Ubuntu 20.04.2, perl 05.30.0, Net::Ping version 2.71 (seen in \nPing.pm) (perl and Net::Ping installed with default Ubuntu packages).\n\nSimple example:\n```\n$ cat t004.pl\n#!/usr/bin/env perl\n\nuse strict;\nuse warnings;\nuse Data::Dumper;\nuse Net::Ping;\n\n# Like tcp protocol, but with many hosts\nmy $p = Net::Ping-\u003enew({\n     proto =\u003e \"syn\",\n     timeout =\u003e 2,     # but dumping $p shows 5??\n});\nprint \"p \", Dumper ($p), \"\\n\";\n\n$ ./t004.pl\np $VAR1 = bless( {\n                  'wbits' =\u003e '',\n                  'syn' =\u003e {},\n                  'port_num' =\u003e 7,\n                  'data' =\u003e '',\n                  'device' =\u003e undef,\n                  'family' =\u003e 2,\n                  'tos' =\u003e undef,\n                  'econnrefused' =\u003e undef,\n                  'stop_time' =\u003e 0,\n                  'retrans' =\u003e '1.2',\n                  'data_size' =\u003e 0,\n                  'local_addr' =\u003e undef,\n                  'seq' =\u003e 0,\n                  'proto' =\u003e 'syn',\n                  'timeout' =\u003e 5,\n                  'proto_num' =\u003e 6,\n                  'bad' =\u003e {}\n                }, 'Net::Ping' );\n```\nNote that timeout is 5 in the Dumper output when t004.pl is run, \nalthough it was initialized to 2 in the hash passed to Net::Ping-\u003enew().\n\nThe reason this happens is that the code for new() in Ping.pm first \nchecks if $proto is a hashref, and if it is moves the possible \nparameters out of it into $self (lines 110-129).\n\nThen it goes through and applies default values to the parameter \nvariables if they are not set; $timeout is set at line 135. $timeout \nwill not be set in the case where the parameters were passed in as a \nhashref, so line 135 will set $timeout to $def_timeout (which is 5).\n\nLine 138 is:\n\n       $self-\u003e{timeout} = $timeout;\n\nAnd that will overwrite the value copied into $self from $proto up in \nlines 110-129.\n\nBunch of obvious ways to fix this. Same thing would appear to happen to \n$device and $tos just after line 138, and probably others elsewhere. It \nlooks like the change to allow a hashref to be passed in with all the \nnamed parameters didn't adequately deal with how defaults were handled \nlater in the code.","files":null},{"type":3,"author":{"id":"8bb2e2064051e551a5dd57a858a993fc9e61081d"},"timestamp":1613991597,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc4MzI4OTU3NA==","github-url":"https://github.com/rurban/Net-Ping/issues/26#issuecomment-783289574"},"message":"Have no idea what's going with your _namedargs.tmodule. Maybe your are loading an old one?\nI've added a testcase `t/160_namedargs.t` to the `release` branch.\nCan you check?","files":null},{"type":6,"author":{"id":"8bb2e2064051e551a5dd57a858a993fc9e61081d"},"timestamp":1613991597,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDM2ODMwODM2"},"target":"5426af6dde4cd4fe0cc16eaf125fb4f8c9c1feccfc8edc9723b5b234fd507caa","message":"Have no idea what's going with your module. Maybe your are loading an old one? The logic looks fine to me.\n\nI've added a testcase `t/160_namedargs.t` to the `release` branch.\nCan you check?","files":null},{"type":6,"author":{"id":"8bb2e2064051e551a5dd57a858a993fc9e61081d"},"timestamp":1613991634,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdElzc3VlQ29tbWVudEVkaXQ6NDM2ODMwOTY5"},"target":"5426af6dde4cd4fe0cc16eaf125fb4f8c9c1feccfc8edc9723b5b234fd507caa","message":"Have no idea what's going with your module. Maybe your are loading an old one? The logic looks fine to me. defaults are only set if there's no proto defined.\n\nI've added a testcase `t/160_namedargs.t` to the `release` branch.\nCan you check?","files":null},{"type":5,"author":{"id":"8bb2e2064051e551a5dd57a858a993fc9e61081d"},"timestamp":1613991980,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQzNTkwNzI1NjM="},"added":["invalid"],"removed":[]},{"type":3,"author":{"id":"7411f4e47e78ea3119099efe23a025995e73e0f6"},"timestamp":1615241546,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDc5MzExOTA3NQ==","github-url":"https://github.com/rurban/Net-Ping/issues/26#issuecomment-793119075"},"message":"I was running version 2.71 (as I said in the initial post). (That's what the Ubunto 20.04 packages provide.)\n\nI installed 2.74 via cpan, and the problem is not present there. Didn't look at the source to see what changed, but my test passes in 2.74.\n\n`$ cat t004.pl \n#!/usr/bin/env perl\n\nuse strict;\nuse warnings;\nuse Data::Dumper;\nuse Net::Ping;\n\n# Like tcp protocol, but with many hosts\nmy $p = Net::Ping-\u003enew({\n    proto =\u003e \"syn\",\n    timeout =\u003e 2,\t # but dumping $p shows 5??\n});\nprint \"p \", Dumper ($p), \"\\n\";\n\nprint \"Net::Ping version loaded is \", $p-\u003eVERSION, \"\\n\";\nddb@ddblap7b:~/Documents/istat\n$ PERL5LIB=~/perl5/lib/perl5 ./t004.pl \np $VAR1 = bless( {\n                 'retrans' =\u003e '1.2',\n                 'device' =\u003e undef,\n                 'econnrefused' =\u003e undef,\n                 'data_size' =\u003e 0,\n                 'data' =\u003e '',\n                 'seq' =\u003e 0,\n                 'proto' =\u003e 'syn',\n                 'tos' =\u003e undef,\n                 'wbits' =\u003e '',\n                 'proto_num' =\u003e 6,\n                 'timeout' =\u003e 2,\n                 'local_addr' =\u003e undef,\n                 'port_num' =\u003e 7,\n                 'stop_time' =\u003e 0,\n                 'bad' =\u003e {},\n                 'family' =\u003e 2,\n                 'syn' =\u003e {}\n               }, 'Net::Ping' );\n\nNet::Ping version loaded is 2.74\n`\nThe test you added certainly looks like it would have found the problem if run on 2.71.","files":null},{"type":4,"author":{"id":"7411f4e47e78ea3119099efe23a025995e73e0f6"},"timestamp":1615252083,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDQyNDQ4NDIxMw=="},"status":2}]}